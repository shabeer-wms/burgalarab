<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Track Order</title>
  <style>
    body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#f6f7f9; margin:0; }
    .container { max-width: 720px; margin: 0 auto; padding: 24px; }
    .card { background:#fff; border-radius: 20px; padding: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); border: 1px solid #e5e7eb; }
    .header { background: linear-gradient(90deg,#0ea5e9,#9333ea); color:#fff; border-radius: 20px 20px 0 0; padding: 24px; }
    .status { display:inline-block; padding: 6px 10px; border-radius: 999px; font-size: 12px; margin-left: 8px; }
    .row { display: flex; justify-content: space-between; margin: 6px 0; }
    .muted { color:#6b7280; }
    .pill { padding: 6px 10px; border-radius: 999px; background:#eef2ff; color:#3730a3; font-weight: 600; font-size:12px; }
    .timeline { display:flex; gap: 10px; margin-top: 16px; }
    .dot { width: 10px; height: 10px; border-radius: 50%; background:#d1d5db; }
    .dot.active { background:#10b981; }
    .footer { text-align:center; color:#6b7280; font-size:12px; margin-top: 16px; }
    .link { word-break: break-all; font-size: 12px; color:#374151; }
  </style>
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://www.googleapis.com" crossorigin>
</head>
<body>
  <div class="container">
    <div class="card" id="card">
      <div class="header">
        <h2 style="margin:0;">Order Tracking</h2>
        <div id="orderId" style="margin-top:6px; opacity:.9;"></div>
      </div>
      <div style="padding: 20px;">
        <div class="row"><div>Customer</div><div id="customer" class="muted"></div></div>
        <div class="row"><div>Type</div><div id="type" class="muted"></div></div>
        <div class="row"><div>Vehicle No</div><div id="vehicle" class="muted"></div></div>
        <div class="row"><div>Total</div><div id="total" class="pill">$0.00</div></div>
        <div style="margin-top:14px;">
          <div>Kitchen Status <span id="kstatus" class="status">-</span></div>
          <div class="timeline">
            <div class="dot" id="dot1" title="Pending"></div>
            <div class="dot" id="dot2" title="In Progress"></div>
            <div class="dot" id="dot3" title="Ready"></div>
          </div>
        </div>
        <div class="footer">
          <p id="updated">Listening for updates...</p>
          <p class="link">Share this link to track: <span id="share"></span></p>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getFirestore, doc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

    const params = new URLSearchParams(location.search);
    const orderId = params.get('order');
    document.getElementById('orderId').textContent = orderId ? `#${orderId.slice(-6)}` : 'No order id';
    document.getElementById('share').textContent = location.href;

    const firebaseConfig = {
      apiKey: "AIzaSyAlLz1bWFwiv3TTe7xqY6q2QU67jTZVRI8",
      authDomain: "hotel-manager-8c1fe.firebaseapp.com",
      projectId: "hotel-manager-8c1fe",
      storageBucket: "hotel-manager-8c1fe.firebasestorage.app",
      messagingSenderId: "515333293848",
      appId: "1:515333293848:web:4f1a425b701fb839dac06d"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    function setDots(status) {
      const s = String(status || '').toLowerCase();
      document.getElementById('dot1').classList.toggle('active', s === 'pending' || s === 'in-progress' || s === 'ready');
      document.getElementById('dot2').classList.toggle('active', s === 'in-progress' || s === 'ready');
      document.getElementById('dot3').classList.toggle('active', s === 'ready');
      const badge = document.getElementById('kstatus');
      const map = { 'pending':'#f59e0b', 'in-progress':'#3b82f6', 'ready':'#10b981' };
      badge.style.background = map[s] || '#e5e7eb';
      badge.style.color = '#fff';
      badge.textContent = (s || '-').toUpperCase();
    }

    if (orderId) {
      // Orders basic info
      onSnapshot(doc(db, 'orders', orderId), (snap) => {
        const o = snap.data();
        if (!o) return;
        document.getElementById('customer').textContent = o.customerName || '-';
        document.getElementById('type').textContent = o.type || '-';
        document.getElementById('vehicle').textContent = o.customerAddress || '-';
        const total = (o.grandTotal || 0).toFixed(2);
        document.getElementById('total').textContent = `$${total}`;
        document.getElementById('updated').textContent = 'Order info updated';
      });
      // Kitchen real-time status
      onSnapshot(doc(db, 'kitchenOrders', orderId), (snap) => {
        const k = snap.data();
        if (!k) return;
        setDots(k.status);
        document.getElementById('updated').textContent = `Kitchen status: ${k.status}`;
      });
    }
  </script>
</body>
</html>
